{{ config(
    materialized='incremental'
) }}

SELECT
    ITAX.SILVER.CONTRIB_0000.INFO_ROW:REG::string   AS REG_0000,
    ITAX.SILVER.CONTRIB_0000.INFO_ROW:CNPJ::string  AS CNPJ_0000,
    ITAX.SILVER.CONTRIB_C010.INFO_ROW:REG::string   AS REG_C010,
    ITAX.SILVER.CONTRIB_C010.INFO_ROW:CNPJ::string  AS CNPJ_C010
FROM
    ITAX.SILVER.CONTRIB_C010
LEFT JOIN
    ITAX.SILVER.CONTRIB_C001 
    ON ITAX.SILVER.CONTRIB_C001.FILE_ID = ITAX.SILVER.CONTRIB_C010.FILE_ID
   AND ITAX.SILVER.CONTRIB_C001.ROW_NUMBER = ITAX.SILVER.CONTRIB_C010.FATHER_ROW
LEFT JOIN
    ITAX.SILVER.CONTRIB_0000 
    ON ITAX.SILVER.CONTRIB_0000.FILE_ID = ITAX.SILVER.CONTRIB_C001.FILE_ID
   AND ITAX.SILVER.CONTRIB_0000.ROW_NUMBER = ITAX.SILVER.CONTRIB_C001.FATHER_ROW
WHERE
    ITAX.SILVER.CONTRIB_0000.INFO_ROW:CNPJ::string = {{ var("cnpj") }}